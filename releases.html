<!doctype html>
<html lang="en">
<head>
<title>releases</title>
<meta charset="utf-8">
<style> * { font-family: arial, sans-serif;
font-size: 13px;
line-height: 17px; }ul.indent { list-style-type: none; }ol { list-style-type: decimal; }ol ol { list-style-type: lower-latin; }ol ol ol { list-style-type: lower-roman; }ol ol ol ol { list-style-type: decimal; }ol ol ol ol ol { list-style-type: lower-latin; }ol ol ol ol ol ol{ list-style-type: lower-roman; }ol ol ol ol ol ol ol { list-style-type: decimal; }ol  ol ol ol ol ol ol ol{ list-style-type: lower-latin; }</style>
</head>
<body><strong><u>Useful information for running releases on production</u></strong><br><br><ul class="bullet"><li>note that some files on production will not appear when running <strong>git status</strong> because of the lines included on <strong>.git&#x2F;info&#x2F;exclude</strong> (e.g., media&#x2F;uploads&#x2F;images&#x2F;**&#x2F;*, media&#x2F;uploads&#x2F;files&#x2F;**&#x2F;*)</li><li><strong>make int</strong> can be used to update the django.po and django.mo translation files</li><li>dependencies on git repositories aren&#8217;t fixed to a specific release, include&nbsp; <strong>-e VCS+REPOS_URL[@REV]#egg=PACKAGE</strong> if neccesary</li><li>in order to update the release branch, you will first need (if it is the first time you work with the release branch) to setup that branch in your local machine (<a href="http&#x3a;&#x2F;&#x2F;gitready&#x2e;com&#x2F;beginner&#x2F;2009&#x2F;03&#x2F;09&#x2F;remote&#x2d;tracking&#x2d;branches&#x2e;html&#x29;">http:&#x2F;&#x2F;gitready.com&#x2F;beginner&#x2F;2009&#x2F;03&#x2F;09&#x2F;remote-tracking-branches.html)</a>, then you can merge from master to release so the release branch includes the last version of lernanta</li><li>useful information for tagging the last commit of a release can be found at <a href="http&#x3a;&#x2F;&#x2F;learn&#x2e;github&#x2e;com&#x2F;p&#x2F;tagging&#x2e;html">http:&#x2F;&#x2F;learn.github.com&#x2F;p&#x2F;tagging.html</a></li><li>to see the changes to the models since the last commit you can use <strong>git diff [last commit id] $(find . -name models.py)</strong></li><li>use <strong>python manage.py sqlall app_name </strong>(need to have the mysql configuration enabled on your local dev environment so it outputs sql appropiate for the server) to see the definition of tables and columns</li><li>use <strong>describe</strong> (<a href="http&#x3a;&#x2F;&#x2F;dev&#x2e;mysql&#x2e;com&#x2F;doc&#x2F;refman&#x2F;5&#x2e;0&#x2F;en&#x2F;describe&#x2e;html&#x29;">http:&#x2F;&#x2F;dev.mysql.com&#x2F;doc&#x2F;refman&#x2F;5.0&#x2F;en&#x2F;describe.html)</a>, <strong>show create table</strong> (<a href="http&#x3a;&#x2F;&#x2F;dev&#x2e;mysql&#x2e;com&#x2F;doc&#x2F;refman&#x2F;5&#x2e;0&#x2F;en&#x2F;show&#x2d;create&#x2d;table&#x2e;html&#x29;">http:&#x2F;&#x2F;dev.mysql.com&#x2F;doc&#x2F;refman&#x2F;5.0&#x2F;en&#x2F;show-create-table.html)</a> and&#x2F;or <strong>show index from</strong> (<a href="http&#x3a;&#x2F;&#x2F;dev&#x2e;mysql&#x2e;com&#x2F;doc&#x2F;refman&#x2F;5&#x2e;0&#x2F;en&#x2F;show&#x2d;index&#x2e;html&#x29;">http:&#x2F;&#x2F;dev.mysql.com&#x2F;doc&#x2F;refman&#x2F;5.0&#x2F;en&#x2F;show-index.html)</a> mysql queries to see the existing database structure</li><li>use <strong>alter table</strong> (<a href="http&#x3a;&#x2F;&#x2F;dev&#x2e;mysql&#x2e;com&#x2F;doc&#x2F;refman&#x2F;5&#x2e;1&#x2F;en&#x2F;alter&#x2d;table&#x2e;html&#x29;">http:&#x2F;&#x2F;dev.mysql.com&#x2F;doc&#x2F;refman&#x2F;5.1&#x2F;en&#x2F;alter-table.html)</a>, <strong>rename table</strong> (<a href="http&#x3a;&#x2F;&#x2F;dev&#x2e;mysql&#x2e;com&#x2F;doc&#x2F;refman&#x2F;5&#x2e;0&#x2F;en&#x2F;rename&#x2d;table&#x2e;html&#x29;">http:&#x2F;&#x2F;dev.mysql.com&#x2F;doc&#x2F;refman&#x2F;5.0&#x2F;en&#x2F;rename-table.html)</a> among other mysql queries to modify existing tables</li><li>the password associated with the ssl certificate will be neccesary to restart apache so you will need to have it at hand before running <strong>&#x2F;etc&#x2F;init.d&#x2F;apache2 restart</strong></li><li>add your email to the <strong>ADMINS</strong> conf in settings_local.py to receive notification emails from django when there is a 500 error</li><li>see apache logs with <strong>tail -f &#x2F;var&#x2F;log&#x2F;apache2&#x2F;lernanta-error.log</strong></li><li>extra configuration related to the setup in production can be found at <strong>&#x2F;etc&#x2F;default&#x2F;celeryd, &#x2F;etc&#x2F;apache2&#x2F;sites-available&#x2F;lernanta, &#x2F;etc&#x2F;apache2&#x2F;sites-available&#x2F;lernanta-ssl</strong></li><li>to restart celeryd use <strong>&#x2F;etc&#x2F;init.d&#x2F;celeryd restart</strong></li><li>to get access to the django shell on production use <strong>python manage.py shell</strong> with the virtualenv activated (~&#x2F;Envs&#x2F;lernanta13).</li><li>to make a copy of the lernanta db use <strong>mysqldump</strong></li><li>to create a database for lernanta in mysql use <strong>CREATE DATABASE &lt;dbname&gt; CHARACTER SET utf8;</strong></li><li>to load a backup into a database run from the bash shell <strong>mysql -u root -p &lt;dbname&gt; &lt; backup.sql</strong> or from the mysql shell <strong>use &lt;dbname&gt;</strong> and <strong>source backup.sql</strong></li><li>use the <strong>MAINTENANCE_MODE</strong> on <strong>settings_local.py</strong> to show a down for manteinance page to all users except site-admins</li><li>use <strong>touch wsgi&#x2F;production.wsgi</strong> to reload wsgi each time you need a change to the code to become active (changes to templates do not require this step)</li><li>use <strong>tar -cvvzf</strong> <strong>lernanta-backup.tar.gz lernanta</strong>&#x2F; to backup the whole lernanta directory with the code, uploaded files, settings_local.py conf, ...</li><li>use <strong>git stash</strong> and <strong>git pull</strong> to update the code from the release branch (do not forget to <strong>touch wsgi&#x2F;production.wsgi</strong>)</li><li>consult <a href="http&#x3a;&#x2F;&#x2F;p2pu&#x2e;lighthouseapp&#x2e;com&#x2F;projects&#x2F;71002&#x2F;tickets&#x2F;426&#x2d;automate&#x2d;anonymization&#x2d;of&#x2d;a&#x2d;copy&#x2d;of&#x2d;the&#x2d;database"><u>http:&#x2F;&#x2F;p2pu.lighthouseapp.com&#x2F;projects&#x2F;71002&#x2F;tickets&#x2F;426-automate-anonymization-of-a-copy-of-the-database</u></a> if you need to get an anonymized version of the db</li><li>consult <a href="http&#x3a;&#x2F;&#x2F;p2pu&#x2e;lighthouseapp&#x2e;com&#x2F;projects&#x2F;71002&#x2F;tickets&#x2F;254&#x2d;automate&#x2d;participants&#x2d;migration"><u>http:&#x2F;&#x2F;p2pu.lighthouseapp.com&#x2F;projects&#x2F;71002&#x2F;tickets&#x2F;254-automate-participants-migration</u></a> if you need to obtain metrics from archive.p2pu.org</li></ul><br><br><br><br><br></body>
</html>
